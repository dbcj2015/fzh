<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bjsxt.nw185.dao.RbacDAO">
	<!-- 获取指定角色所能访问的模块 -->
	<select id="findModules" parameterType="java.util.Map" resultType="java.util.LinkedHashMap">
		SELECT DISTINCT m.module_id , m.module_name , m.icon 
		FROM  t_role_function  rf, t_function f , t_module m 
		WHERE 
			rf.function_id = f.function_id 
			AND f.module_id = m.module_id 
			AND rf.role_id IN 
			<!-- (2,3,4,5) -->
			<foreach collection="roles" open="(" close=")" separator="," item="rid">
				#{rid}
			</foreach>
	</select>
	
	
	<select id="findFunctions" parameterType="java.util.Map" resultType="java.util.LinkedHashMap">
	
		SELECT DISTINCT f.* FROM  t_role_function  rf, t_function f 
		WHERE 
			rf.function_id = f.function_id 
			AND f.module_id = #{moduleId} 
			AND rf.role_id IN 
			<foreach collection="roles" open="(" close=")" separator="," item="rid">
				#{rid}
			</foreach>
			
	</select>
	
	
	
	<select id="findRolesByEmp" parameterType="Integer" resultType="java.util.LinkedHashMap">
		SELECT * FROM t_employee e , t_role_emp re WHERE e.emp_id = re.emp_id AND e.emp_id = #{value}
	</select>
</mapper>